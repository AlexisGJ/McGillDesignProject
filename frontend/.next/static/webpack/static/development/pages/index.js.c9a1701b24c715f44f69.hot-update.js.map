{"version":3,"file":"static/webpack/static/development/pages/index.js.c9a1701b24c715f44f69.hot-update.js","sources":["webpack:///./components/ModalComponent.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\nimport Typography from '@material-ui/core/Typography';\nimport Modal from '@material-ui/core/Modal';\nimport Grid from '@material-ui/core/Grid';\nimport TextField from '@material-ui/core/TextField';\nimport Button from '@material-ui/core/Button';\nimport Fab from '@material-ui/core/Fab';\nimport RefreshIcon from '@material-ui/icons/Refresh';\nimport moment from 'moment';\n\nimport { scale, scalePow, scaleLog } from 'd3-scale';\nimport { ResponsiveContainer, LineChart, Line, XAxis, YAxis, ReferenceLine,\n  ReferenceDot, ReferenceArea, Tooltip, CartesianGrid, Legend, Brush, ErrorBar, AreaChart, Area,\n  Label, LabelList } from 'recharts';\n\nfunction getModalStyle() {\n  const top = 50;\n  const left = 50;\n\n  return {\n    top: `${top}%`,\n    left: `${left}%`,\n    transform: `translate(-${top}%, -${left}%)`,\n    borderRadius: '5px',\n  };\n}\n\nconst styles = theme => ({\n  paper: {\n    position: 'absolute',\n    // width: theme.spacing.unit * 50,\n    width: 600,\n    backgroundColor: theme.palette.background.paper,\n    boxShadow: theme.shadows[5],\n    padding: theme.spacing.unit * 4,\n    outline: 'none',\n  },\n});\n\nclass CustomizedAxisTick extends React.Component {\n  render() {\n    const {\n      x, y, stroke, payload,\n    } = this.props;\n\n    const date = moment(new Date()).subtract(-payload.value, \"minutes\").format(\"HH:mm\");\n\n    return (\n      <g transform={`translate(${x},${y})`}>\n        <text x={0} y={0} dy={16} textAnchor=\"end\" fill=\"#666\" transform=\"rotate(-45)\">{date}</text>\n      </g>\n    );\n  }\n}\n\nconst CustomTooltip = ({ active, payload, label }) => {\n  if (active) {\n    const date = moment(new Date()).subtract(-label, \"minutes\").fromNow();\n    return (\n      <div className=\"custom-tooltip\">\n        <div className=\"value\">{`${payload[0].value}`} <span>mmol/L</span></div>\n        <div className=\"time\">{date}</div>\n      </div>\n    );\n  }\n\n  return null;\n};\n\nconst getAxisYDomain = (data, from, to, ref, offset) => {\n  const refData = data.slice(from, to);\n  let [ bottom, top ] = [ refData[0][ref], refData[0][ref] ];\n  refData.forEach( d => {\n  \tif ( d[ref] > top ) top = d[ref];\n    if ( d[ref] < bottom ) bottom = d[ref];\n  });\n  \n  return [ (bottom|0) - offset, (top|0) + offset ]\n};\n\nconst initialState = {\n  left : -100,\n  right : 0,\n  refAreaLeft : '',\n  refAreaRight : '',\n  top : 10,\n  bottom : 0,\n  animation : true\n};\n\nclass SimpleModal extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {loaded: false, data: props.data, allData: props.data, initialState};\n    this.zoomOut();\n  }\n\n  componentDidMount() {\n    this.setState({loaded: true});\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if(nextProps.data!==this.props.data){\n      if (nextProps.data.readings) {\n        this.setState({\n          data: nextProps.data.readings.reverse(),\n          allData: nextProps.data,\n        });\n      }\n    }\n  }\n\n  zoom() {\n    let { refAreaLeft, refAreaRight, data } = this.state;\n    \n    console.log(this.state.data);\n\n\t\tif ( refAreaLeft === refAreaRight || refAreaRight === '' ) {\n    \tthis.setState( () => ({\n      \trefAreaLeft : '',\n        refAreaRight : ''\n      }) );\n    \treturn;\n    }\n\n\t\t// xAxis domain\n\t  if ( refAreaLeft > refAreaRight ) \n        [ refAreaLeft, refAreaRight ] = [ refAreaRight, refAreaLeft ];\n    \n    \n    var leftArrayIndex = 0;\n    for (var i=0; i<data.length; i++) {\n      if (data[i].dateFromNowMinutes > refAreaLeft) {\n        leftArrayIndex = i;\n        break;\n      }\n    }\n\n    var rightArrayIndex = 0;\n    for (var i=data.length-1; i>=0; i--) {\n      if (data[i].dateFromNowMinutes < refAreaRight) {\n        rightArrayIndex = i;\n        break;\n      }\n    }\n\n\t\t// yAxis domain\n    const [ bottom, top ] = getAxisYDomain( data, leftArrayIndex, rightArrayIndex, 'mmol', 1 );\n    \n    this.setState( () => ({\n      refAreaLeft : '',\n      refAreaRight : '',\n    \tdata : data.slice(),\n      left : refAreaLeft,\n      right : refAreaRight,\n      bottom, top\n    } ) );\n  };\n\n\tzoomOut () {\n    const { data } = this.state;\n    \n  \tthis.setState( () => ({\n      data : data.slice(),\n      refAreaLeft : '',\n      refAreaRight : '',\n      left : 'dataMin',\n      right : '0',\n      top : 'dataMax+1',\n      bottom : 0,\n    }) );\n  };\n\n  render() {\n    const { classes } = this.props;\n    const { loaded, data, allData, barIndex, left, right, refAreaLeft, refAreaRight, top, bottom } = this.state;\n\n    if (!loaded || !allData._id) {\n      return null;\n    } else {\n      return (\n        <div>\n          <Modal\n            aria-labelledby=\"simple-modal-title\"\n            aria-describedby=\"simple-modal-description\"\n            open={this.props.open}\n            onClose={this.props.handleClose}\n          >\n            <div style={getModalStyle()} className={classes.paper}>\n              <Typography variant=\"h4\" id=\"modal-title\">\n                {allData.name}\n              </Typography>\n\n              <Grid container>\n                <Grid item xs={4}>\n                    <TextField\n                        id=\"outlined-name-input\"\n                        label=\"Appareil\"\n                        className={classes.textField}\n                        type=\"text\"\n                        name=\"device\"\n                        margin=\"normal\"\n                        variant=\"outlined\"\n                        InputProps={{\n                          readOnly: true,\n                        }}\n                        value={allData.latestReading.device}\n                    />\n                </Grid>\n                <Grid item xs={4}>\n                    <TextField\n                        id=\"outlined-sensorId-input\"\n                        label=\"Emplacement\"\n                        className={classes.textField}\n                        type=\"text\"\n                        name=\"location\"\n                        margin=\"normal\"\n                        variant=\"outlined\"\n                        InputProps={{\n                          readOnly: true,\n                        }}\n                        value={allData.location}\n                    />\n                </Grid>\n                <Grid item xs={4}>\n                  <Fab color=\"primary\" aria-label=\"Add\" style={{float: 'right', marginTop: '12px'}} onClick={this.zoomOut.bind(this)}>\n                    <RefreshIcon />\n                  </Fab>\n                </Grid>\n              </Grid>\n\n              <LineChart\n                  width={600}\n                  height={500}\n                  data={data}\n                  margin={{ top: 5, right: 20, left: 0, bottom: 5 }}\n                  className=\"line-chart\"\n                  onMouseDown = { (e) => {if (e) {this.setState({refAreaLeft:e.activeLabel})}} }\n                  onMouseMove = { (e) => this.state.refAreaLeft && this.setState({refAreaRight:e.activeLabel}) }\n                  onMouseUp = { this.zoom.bind( this ) }\n                  >\n                  <XAxis allowDataOverflow={true} domain={[left, right]} type=\"number\" dataKey=\"dateFromNowMinutes\" height={140} tick={<CustomizedAxisTick />} label=\"temps\"/>\n                  <YAxis allowDataOverflow={true} domain={[0, top]} width={80} yAxisId=\"first\">\n                    <Label value=\"mmol/L\" offset={5} position=\"insideTopLeft\" />\n                  </YAxis>\n                  <Tooltip content={<CustomTooltip />} />\n                  <CartesianGrid stroke=\"#f5f5f5\" />\n\n                  <Line yAxisId=\"first\" type=\"monotone\" dataKey=\"mmol\" stroke=\"#54a4ef\" strokeWidth={2} dot={{ r: 1 }} />\n                  <ReferenceLine yAxisId=\"first\" y={data.range_min} stroke=\"#97191b\" strokeWidth={2} className=\"graph-referenece-line\" >\n                    <Label value={\"MIN \" + data.range_min} offset={5} position=\"insideTopRight\" />\n                  </ReferenceLine>\n                  <ReferenceLine yAxisId=\"first\" y={data.range_max} stroke=\"#97191b\" strokeWidth={2} className=\"graph-referenece-line\" >\n                    <Label value={\"MAX \" + data.range_max} offset={5} position=\"insideBottomRight\" />\n                  </ReferenceLine>\n\n                  {\n                    (refAreaLeft && refAreaRight) ? (\n                    <ReferenceArea yAxisId=\"first\" x1={refAreaLeft} x2={refAreaRight}  strokeOpacity={0.3} /> ) : null\n                  \n                  }\n\n              </LineChart>\n            </div>\n          </Modal>\n        </div>\n      );\n    }\n\n  }\n}\n\nSimpleModal.propTypes = {\n  classes: PropTypes.object.isRequired,\n};\n\n// We need an intermediary variable for handling the recursive nesting.\nconst SimpleModalWrapped = withStyles(styles)(SimpleModal);\n\nexport default SimpleModalWrapped;"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AADA;AAAA;AACA;AAWA;;;;;;;;;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;;AAbA;AACA;AAeA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AACA;AASA;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAJA;AAIA;AACA;;;AACA;AACA;AAAA;AAAA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAAA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AADA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlCA;AAAA;AAAA;AAAA;AACA;AAoCA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AANA;AAAA;AAQA;;;AAEA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAAA;AASA;;;AAEA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAEA;;;;AApLA;AACA;AAsLA;AACA;AADA;AACA;AAIA;AAEA;;;;A","sourceRoot":""}